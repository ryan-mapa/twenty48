!function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var i=class{constructor(e,t){this.compare=this.compare.bind(this);let r=document.createElement("div");r.classList.add("tile"),r.innerHTML=e,this.val=e,this.el=r,this.pos=t}compare(e){return this.val===e.val}absorb(e){this.val=parseInt(e.val)+parseInt(this.val),this.el.innerHTML=this.val,e.el.parentElement.removeChild(e.el)}};var o=class{constructor(e){const t=document.createElement("div");t.classList.add("cell"),t.setAttribute("data-pos",JSON.stringify(e)),this.el=t,this.tile=null}pos(){return JSON.parse(this.el.getAttribute("data-pos"))}insertTile(e,t){this.tile&&e.absorb(this.tile),t&&t.removeTile(e),this.el.appendChild(e.el),this.tile=e}removeTile(e){this.el.removeChild(e.el),this.tile=null}isEmpty(){return!this.tile}};var n=class{constructor(e){let t=new Array,r=document.createElement("div");r.classList.add("game-container");for(let i=0;i<e;i++){let n=new Array;for(let t=0;t<e;t++){let e=new o([i,t]);n.push(e),r.appendChild(e.el)}t.push(n)}this.grid=t,this.el=r}index(e){let[t,r]=e;return this.grid[t][r]}build(){}insertTile(e){let[t,r]=e.pos;this.grid[t][r].insertTile(e)}};const s=4,l={left:[0,-1],right:[0,1],up:[-1,0],down:[1,0]},d=function(e,t){let r=!0;return(...i)=>{r&&(r=!1,e(...i),setTimeout(()=>r=!0,t))}};var a=class{constructor(e,t=new n(s)){this.el=e,this.board=t,this.handleKeyPress=this.handleKeyPress.bind(this),this.debouncedHandleKey=d(this.handleKeyPress,250),this.createBoard(),this.addEventListeners(),this.endGame()}addEventListeners(){var e;document.addEventListener("keydown",e=>{37==e.keyCode&&this.debouncedHandleKey("left"),38==e.keyCode&&this.debouncedHandleKey("up"),39==e.keyCode&&this.debouncedHandleKey("right"),40==e.keyCode&&this.debouncedHandleKey("down")}),this.el.addEventListener("touchstart",function(e){const i=e.touches[0];t=i.clientX,r=i.clientY},!1),this.el.addEventListener("touchmove",(e=this.debouncedHandleKey,i=>{if(i.preventDefault(),!t||!r)return;let o=i.touches[0].clientX,n=i.touches[0].clientY,s=t-o,l=r-n;Math.abs(s)>Math.abs(l)?e(s>0?"left":"right"):e(l>0?"up":"down"),t=null,r=null}),!1);let t=null,r=null}handleKeyPress(e){this.executeMoves(e)&&this.addRandomTile(),this.isBoardFull()&&(console.log("tooo fulll"),this.checkGameOver())}isBoardFull(){return this.buildMoveCoordForDir("up").filter(e=>!this.board.index(e).isEmpty()).length===s*s}gameOver(){window.setTimeout(()=>alert("GAME OVER!"),100)}youWin(){alert("you did it!")}findMovePos(e,t,r){let i=this.nextPos(e,t),o=this.board.index(r);if(this.inBounds(i)){let n=this.board.index(i);return n.isEmpty()||n.tile.compare(o.tile)?this.findMovePos(i,t,r):e}return e}move(e,t){let r=this.board.index(e.pos);this.board.index(t).insertTile(e,r),e.pos=t}fourOrTwo(){return Math.random()>.15?2:4}inBounds(e){let[t,r]=e;return!(t>=s||t<0||r>=s||r<0)}nextPos(e,t){return[e[0]+t[0],e[1]+t[1]]}createBoard(){this.el.appendChild(this.board.el)}newGame(){let e=new i(this.fourOrTwo(),this.randomEmptyPos());this.board.insertTile(e);let t=new i(this.fourOrTwo(),this.randomEmptyPos());this.board.insertTile(t)}endGame(){for(let e=0;e<15;e++)this.board.insertTile(new i(2,this.randomEmptyPos()))}addRandomTile(){let e=new i(this.fourOrTwo(),this.randomEmptyPos());this.board.insertTile(e)}randomEmptyPos(){let e=Math.floor(Math.random()*s),t=Math.floor(Math.random()*s);return this.board.grid[e][t].isEmpty()?[e,t]:this.randomEmptyPos()}executeMoves(e){let t=this.buildMoveCoordForDir(e),r=l[e],i=0;for(let e of t){if(this.board.index(e).isEmpty())continue;let t=this.board.index(e).tile,o=this.findMovePos(e,r,e);o!=e&&(i+=1,this.move(t,o))}return i>0}testPossibleMove(e){let t=this.buildMoveCoordForDir(e),r=l[e],i=0;for(let e of t)this.board.index(e).isEmpty()||(this.board.index(e).tile,this.findMovePos(e,r,e)!=e&&(i+=1));return i>0}checkGameOver(){let e=Object.keys(l),t=0;for(let r of e)this.testPossibleMove(r)&&t++;console.log(t),0===t&&this.gameOver()}buildMoveCoordForDir(e){let t=[];switch(e){case"left":for(let e=0;e<s;e++)for(let r=0;r<s;r++)t.push([r,e]);return t;case"right":for(let e=s-1;e>=0;e--)for(let r=s-1;r>=0;r--)t.push([r,e]);return t;case"up":for(let e=0;e<s;e++)for(let r=0;r<s;r++)t.push([e,r]);return t;case"down":for(let e=s-1;e>=0;e--)for(let r=s-1;r>=0;r--)t.push([e,r]);return t}}};document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".cell"),t=document.getElementById("g2048");for(let t of e)t.addEventListener("click",()=>{});let r=new a(t);window.game=r})}]);